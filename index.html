<html lang="FR">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>TD1 Cartographie</title>

    <style src="style.css"></style>

    <head>
        <h1> TD1 Géolocalisation</h1>
    </head>

    <div id="dvd"></div>

    <body>

        <h2>Exercice 2 : </h2>

        <h3>Avec getCurrentPosition() : </h3>
        <p id="Latitude"></p>
        <p id="Longitude"></p>
        <p id="Altitude"></p>
        <p id="Précision"></p>
        <p id="Vitesse"></p>
        <p id="Date"></p>

        <h3>Avec watchPosition() : </h3>
        <p id="Latitude1"></p>
        <p id="Longitude1"></p>
        <p id="Altitude1"></p>
        <p id="Précision1"></p>
        <p id="Vitesse1"></p>
        <p id="Date1"></p>

        <h2>Exercice 3 : </h2>
        <h3>Avec deviceMotion : </h3>
        <p id="alpha"></p>
        <p id="beta"></p>
        <p id="gamma"></p>
        <p id="accelrota"></p>
        <p id="acceltransla"></p>

        <h3>Avec deviceOrientation : </h3>
        <p id="alphaor"></p>
        <p id="betaor"></p>
        <p id="gammaor"></p>
        <p>Par contre il ne récupère pas la translation du téléphone sur les différents axes. </p>

        <h2>Exercice 4 : </h2>
        <canvas id="touchable" width="600" height="600" style="border:solid black 1px;"></canvas>

        <pre id="log" style="border: 1px solid #ccc;"></pre>

    </body>

    <script src="dvd.js"></script>

    <script>
        lat = document.getElementById("Latitude");
        long = document.getElementById("Longitude");
        alt = document.getElementById("Altitude");
        prec = document.getElementById("Précision");
        vit = document.getElementById("Vitesse");
        date = document.getElementById("Date");

        lat1 = document.getElementById("Latitude1");
        long1 = document.getElementById("Longitude1");
        alt1 = document.getElementById("Altitude1");
        prec1 = document.getElementById("Précision1");
        vit1 = document.getElementById("Vitesse1");
        date1 = document.getElementById("Date1");

        navigator.geolocation.getCurrentPosition(showPositionCurrent);
        navigator.geolocation.watchPosition(showPositionWatch);


        function showPositionCurrent(position){
            lat.innerHTML = "Latitude : " + position.coords.latitude
            long.innerHTML = "Longitude : " + position.coords.longitude
            alt.innerHTML = "Altitude : " + position.coords.altitude
            prec.innerHTML = "Précision : " + position.coords.accuracy
            vit.innerHTML = "Vitesse : " + position.coords.speed
            date.innerHTML = "Date : " + position.timestamp
        }

        function showPositionWatch(position){
            lat1.innerHTML = "Latitude Update : " + position.coords.latitude
            long1.innerHTML = "Longitude Update : " + position.coords.longitude
            alt1.innerHTML = "Altitude Update : " + position.coords.altitude
            prec1.innerHTML = "Précision Update : " + position.coords.accuracy
            vit1.innerHTML = "Vitesse Update : " + position.coords.speed
            date1.innerHTML = "Date Update : " + position.timestamp
        }

    </script>
        
    <script>

        alpha = document.getElementById("alpha");
        beta = document.getElementById("beta");
        gamma = document.getElementById("gamma");
        accelrota = document.getElementById("accelrota")
        acceltransla = document.getElementById("acceltransla")

        alphaor = document.getElementById("alphaor");
        betaor = document.getElementById("betaor");
        gammaor = document.getElementById("gammaor");

        window.addEventListener("deviceorientation",(motion) => {
            alphaor.innerHTML = "Vitesse de rotation sur l'axe z : " + motion.alpha
            betaor.innerHTML = "Vitesse de rotation sur l'axe x : " + motion.beta
            gammaor.innerHTML = "Vitesse de rotation sur l'axe y : " + motion.gamma
        });


        window.addEventListener("devicemotion",(motion) => {
            alpha.innerHTML = "Vitesse de rotation sur l'axe z : " + motion.rotationRate.alpha
            beta.innerHTML = "Vitesse de rotation sur l'axe x : " + motion.rotationRate.beta
            gamma.innerHTML = "Vitesse de rotation sur l'axe y : " + motion.rotationRate.gamma
            accelrota.innerHTML = "Vitesse de translation sur y : " + motion.acceleration.y
            acceltransla.innerHTML = "Vitesse de translation sur x :" + motion.acceleration.x
        });

    </script>

    <script>

        const ongoingTouches = [];

        document.addEventListener("DOMContentLoaded", démarrage);

        function démarrage() 
        {
            const el = document.getElementById("touchable");
            el.addEventListener("touchstart", début);
            el.addEventListener("touchend", fin);
            el.addEventListener("touchcancel", annuler);
            el.addEventListener("touchmove", déplacement);
            log("Initialisé");
        }

        function début(event) 
        {
            event.preventDefault();
            log("c'est le début de la forme")
            const el = document.getElementById("touchable");
            const ctx = el.getContext("2d");
            const touches = event.changedTouches;

            for (let i = 0; i < touches.length; i++) 
            {
                log(`début de touché : ${i}.`);
                ongoingTouches.push(copyTouch(touches[i]));
                const color = colorForTouch(touches[i]);
                log(`couleur du touché avec l'id ${touches[i].identifier} = ${color}`);
                ctx.beginPath();
                ctx.arc(touches[i].pageX, touches[i].pageY, 4, 0, 2 * Math.PI, false); // a circle at the start
                ctx.fillStyle = color;
                ctx.fill();
                
            }
        }

        function déplacement(event) 
        {
            event.preventDefault();
            log("le touché continue et on se déplace")
            const el = document.getElementById("touchable");
            const ctx = el.getContext("2d");
            const touches = event.changedTouches;

            for (let i = 0; i < touches.length; i++) 
            {
                const color = colorForTouch(touches[i]);
                const idx = ongoingTouchIndexById(touches[i].identifier);

                if (idx >= 0) 
                {
                    log(`le touché continue ${idx}`);
                    ctx.beginPath();                    
                    ctx.lineWidth = 4;
                    ctx.strokeStyle = color;
                    log(`ctx.moveTo( ${ongoingTouches[idx].pageX}, ${ongoingTouches[idx].pageY} );`,);
                    ctx.moveTo(ongoingTouches[idx].pageX, ongoingTouches[idx].pageY);
                    log(`ctx.lineTo( ${touches[i].pageX}, ${touches[i].pageY} );`);
                    ctx.lineTo(touches[i].pageX, touches[i].pageY);
                    ctx.stroke();
                    ctx.fillStyle = color;
                    ctx.fill();
                    ongoingTouches.splice(idx, 1, copyTouch(touches[i])); // swap in the new touch record
                } 
                else 
                {
                    log("on ne sait pas avec quel touché il faut continuer");
                }
            }
        }

        function fin(event) 
        {
            event.preventDefault();
            log("la fin approche...");
            const el = document.getElementById("touchable");
            const ctx = el.getContext("2d");
            const touches = event.changedTouches;

            for (let i = 0; i < touches.length; i++) 
            {
                const color = colorForTouch(touches[i]);
                let idx = ongoingTouchIndexById(touches[i].identifier);

                if (idx >= 0) 
                {
                    ctx.lineWidth = 4;
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.moveTo(ongoingTouches[idx].pageX, ongoingTouches[idx].pageY);
                    ctx.lineTo(touches[i].pageX, touches[i].pageY);
                    ctx.fillRect(touches[i].pageX - 4, touches[i].pageY - 4, 8, 8); // and a square at the end
                    ongoingTouches.splice(idx, 1); // remove it; we're done
                    ctx.closePath()
                } 
                else 
                {
                    log("On ne sait pas avec quel touché finir");
                }
            }
        }

        function annuler(event) {
            event.preventDefault();
            log("annulation du touché ");
            const touches = event.changedTouches;

            for (let i = 0; i < touches.length; i++) {
                let idx = ongoingTouchIndexById(touches[i].identifier);
                ongoingTouches.splice(idx, 1); // remove it; we're done
            }
        }

        function colorForTouch(touch) 
        {
            let r = touch.identifier % 16;
            let g = Math.floor(touch.identifier / 3) % 16;
            let b = Math.floor(touch.identifier / 7) % 16;
            r = r.toString(16); // make it a hex digit
            g = g.toString(16); // make it a hex digit
            b = b.toString(16); // make it a hex digit
            const color = `#${r}${g}${b}`;
            return color;
        }

        function copyTouch({ identifier, pageX, pageY }) 
        {
            return { identifier, pageX, pageY };
        }

        function ongoingTouchIndexById(idToFind) {
            for (let i = 0; i < ongoingTouches.length; i++) {
                const id = ongoingTouches[i].identifier;

                if (id === idToFind) 
                {
                    return i;
                }
            }
            return -1; // not found
        }

        function log(msg) 
        {
            const container = document.getElementById("log");
            container.innerHTML = `${msg} \n${container.textContent}`;
        }

    </script>

</html>

