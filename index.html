<html lang="FR">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>TD Cartographie</title>

    <style src="style.css"></style>

    <head>
        <h1> TD1 Géolocalisation</h1>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
            integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
            crossorigin=""/>
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin="">
        </script>
        <link rel="stylesheet" href="style.css">

        <script type="importmap">
            {
              "imports": {
                "three": "https://unpkg.com/three@v0.157.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@v0.157.0/examples/jsm/"
              }
            }
          </script>

    </head>

    <div id="dvd"></div>

    <body>

        <h2>Exercice 2 : </h2>

        <h3>Avec getCurrentPosition() : </h3>
        <p id="Latitude"></p>
        <p id="Longitude"></p>
        <p id="Altitude"></p>
        <p id="Précision"></p>
        <p id="Vitesse"></p>
        <p id="Date"></p>

        <h3>Avec watchPosition() : </h3>
        <p id="Latitude1"></p>
        <p id="Longitude1"></p>
        <p id="Altitude1"></p>
        <p id="Précision1"></p>
        <p id="Vitesse1"></p>
        <p id="Date1"></p>

        <h2>Exercice 3 : </h2>
        <h3>Avec deviceMotion : </h3>
        <p id="alpha"></p>
        <p id="beta"></p>
        <p id="gamma"></p>
        <p id="accelrota"></p>
        <p id="acceltransla"></p>

        <h3>Avec deviceOrientation : </h3>
        <p id="alphaor"></p>
        <p id="betaor"></p>
        <p id="gammaor"></p>
        <p>Par contre il ne récupère pas la translation du téléphone sur les différents axes. </p>

        <h2>Exercice 4 : </h2>
        <canvas id="touchable" width="600" height="600" style="border:solid black 1px;"></canvas>

        <pre id="log" style="border: 1px solid #ccc;"></pre>

        <h1>TD2 Géolocalisation</h1>

        <h3> Exercice 1 & 2 & 3 : </h3>

        <div id="map"></div>

        <script type="text/javascript" src="https://stamen-maps.a.ssl.fastly.net/js/tile.stamen.js?v1.3.0"></script>

        <script>
            
            navigator.geolocation.getCurrentPosition(showPositionCurrent);
    
            var map = L.map('map').setView([0, 0], 0);
            L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/toner/{z}/{x}/{y}.{ext}', {
                attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
                minZoom: 1,
                maxZoom: 20,
                ext: 'png'
                }).addTo(map);
            
            var latmarseille = 43.28418760599563;
            var longmarseille = 5.3708085461105375;
            var latnice = 43.70184427711055;
            var longnice = 7.267804998512;
            
            var calculDistanceMarseilleNice = 6371*Math.acos(Math.sin(latmarseille*(Math.PI/180))*Math.sin(latnice*(Math.PI/180))+Math.cos(latmarseille*(Math.PI/180))*Math.cos(latnice*(Math.PI/180))*Math.cos((longnice-longmarseille)*(Math.PI/180)));
    
            
            var markercarros = L.marker([43.792596605930434, 7.187898645370745]).addTo(map);
            markercarros.bindPopup("<b>La distance Nice Marseille est de "+ calculDistanceMarseilleNice + " km </b>").openPopup();
    
            var circle = L        
    
            var polygon = L.polygon([
                [18.466089250248615, -66.08004633163162],
                [26.702303129375387, -80.05321001804164],
                [32.31162535168669, -64.86875361089508]
                ]).addTo(map);
    
            polygon.setStyle({fillColor: '#FF0000', color: "#FF0000"});
    
            var coordsmarseille = [43.28418760599563, 5.3708085461105375];
            var coordsnice = [43.70184427711055, 7.267804998512];
            
            var calculDistanceMarseilleNice = 6371*Math.acos(Math.sin(43.2841876059956*(Math.PI/180))*Math.sin(43.70184427711055*(Math.PI/180))+Math.cos(43.2841876059956*(Math.PI/180))*Math.cos(43.70184427711055*(Math.PI/180))*Math.cos((5.3708085461105375-7.267804998512)*(Math.PI/180)));
    
            function showPositionCurrent(position)
            {
                map.setView([position.coords.latitude,position.coords.longitude], 10);
                L.marker([position.coords.latitude,position.coords.longitude]).addTo(map);
                L.marker([43.70184427711055, 7.267804998512]).addTo(map);
                circle.circle([position.coords.latitude,position.coords.longitude], {
                    color: 'red',
                    fillColor: '#f03',
                    fillOpacity: 0.5,
                    radius: position.coords.accuracy
                    }).addTo(map);
            }
            
        </script>

        <script>
            fetch('https://pierrinator125.github.io/routes-metropolitaines.geojson')
                .then((response) => response.json())
                .then((json) => {
                L.geoJSON(json).addTo(map);
            });
        </script>


    </body>

    <script src="dvd.js"></script>

    <script>
        lat = document.getElementById("Latitude");
        long = document.getElementById("Longitude");
        alt = document.getElementById("Altitude");
        prec = document.getElementById("Précision");
        vit = document.getElementById("Vitesse");
        date = document.getElementById("Date");

        lat1 = document.getElementById("Latitude1");
        long1 = document.getElementById("Longitude1");
        alt1 = document.getElementById("Altitude1");
        prec1 = document.getElementById("Précision1");
        vit1 = document.getElementById("Vitesse1");
        date1 = document.getElementById("Date1");

        navigator.geolocation.getCurrentPosition(showPositionCurrent);
        navigator.geolocation.watchPosition(showPositionWatch);


        function showPositionCurrent(position){
            lat.innerHTML = "Latitude : " + position.coords.latitude
            long.innerHTML = "Longitude : " + position.coords.longitude
            alt.innerHTML = "Altitude : " + position.coords.altitude
            prec.innerHTML = "Précision : " + position.coords.accuracy
            vit.innerHTML = "Vitesse : " + position.coords.speed
            date.innerHTML = "Date : " + position.timestamp
        }

        function showPositionWatch(position){
            lat1.innerHTML = "Latitude Update : " + position.coords.latitude
            long1.innerHTML = "Longitude Update : " + position.coords.longitude
            alt1.innerHTML = "Altitude Update : " + position.coords.altitude
            prec1.innerHTML = "Précision Update : " + position.coords.accuracy
            vit1.innerHTML = "Vitesse Update : " + position.coords.speed
            date1.innerHTML = "Date Update : " + position.timestamp
        }

    </script>
        
    <script>

        alpha = document.getElementById("alpha");
        beta = document.getElementById("beta");
        gamma = document.getElementById("gamma");
        accelrota = document.getElementById("accelrota")
        acceltransla = document.getElementById("acceltransla")

        alphaor = document.getElementById("alphaor");
        betaor = document.getElementById("betaor");
        gammaor = document.getElementById("gammaor");

        window.addEventListener("deviceorientation",(motion) => {
            alphaor.innerHTML = "Vitesse de rotation sur l'axe z : " + motion.alpha
            betaor.innerHTML = "Vitesse de rotation sur l'axe x : " + motion.beta
            gammaor.innerHTML = "Vitesse de rotation sur l'axe y : " + motion.gamma
        });


        window.addEventListener("devicemotion",(motion) => {
            alpha.innerHTML = "Vitesse de rotation sur l'axe z : " + motion.rotationRate.alpha
            beta.innerHTML = "Vitesse de rotation sur l'axe x : " + motion.rotationRate.beta
            gamma.innerHTML = "Vitesse de rotation sur l'axe y : " + motion.rotationRate.gamma
            accelrota.innerHTML = "Vitesse de translation sur y : " + motion.acceleration.y
            acceltransla.innerHTML = "Vitesse de translation sur x :" + motion.acceleration.x
        });

    </script>

    <script>

        const ongoingTouches = [];

        document.addEventListener("DOMContentLoaded", démarrage);

        function démarrage() 
        {
            const el = document.getElementById("touchable");
            el.addEventListener("touchstart", début);
            el.addEventListener("touchend", fin);
            el.addEventListener("touchcancel", annuler);
            el.addEventListener("touchmove", déplacement);
            log("Initialisé");
        }

        function début(event) 
        {
            event.preventDefault();
            log("c'est le début de la forme")
            const el = document.getElementById("touchable");
            const ctx = el.getContext("2d");
            const touches = event.changedTouches;

            for (let i = 0; i < touches.length; i++) 
            {
                log(`début de touché : ${i}.`);
                ongoingTouches.push(copyTouch(touches[i]));
                const color = colorForTouch(touches[i]);
                log(`couleur du touché avec l'id ${touches[i].identifier} = ${color}`);
                ctx.beginPath();
                ctx.arc(touches[i].pageX, touches[i].pageY, 4, 0, 2 * Math.PI, false); // a circle at the start
                ctx.fillStyle = color;
                ctx.fill();
                
            }
        }

        function déplacement(event) 
        {
            event.preventDefault();
            log("le touché continue et on se déplace")
            const el = document.getElementById("touchable");
            const ctx = el.getContext("2d");
            const touches = event.changedTouches;

            for (let i = 0; i < touches.length; i++) 
            {
                const color = colorForTouch(touches[i]);
                const idx = ongoingTouchIndexById(touches[i].identifier);

                if (idx >= 0) 
                {
                    log(`le touché continue ${idx}`);
                    ctx.beginPath();                    
                    ctx.lineWidth = 4;
                    ctx.strokeStyle = color;
                    log(`ctx.moveTo( ${ongoingTouches[idx].pageX}, ${ongoingTouches[idx].pageY} );`,);
                    ctx.moveTo(ongoingTouches[idx].pageX, ongoingTouches[idx].pageY);
                    log(`ctx.lineTo( ${touches[i].pageX}, ${touches[i].pageY} );`);
                    ctx.lineTo(touches[i].pageX, touches[i].pageY);
                    ctx.stroke();
                    ctx.fillStyle = color;
                    ctx.fill();
                    ongoingTouches.splice(idx, 1, copyTouch(touches[i])); // swap in the new touch record
                } 
                else 
                {
                    log("on ne sait pas avec quel touché il faut continuer");
                }
            }
        }

        function fin(event) 
        {
            event.preventDefault();
            log("la fin approche...");
            const el = document.getElementById("touchable");
            const ctx = el.getContext("2d");
            const touches = event.changedTouches;

            for (let i = 0; i < touches.length; i++) 
            {
                const color = colorForTouch(touches[i]);
                let idx = ongoingTouchIndexById(touches[i].identifier);

                if (idx >= 0) 
                {
                    ctx.lineWidth = 4;
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.moveTo(ongoingTouches[idx].pageX, ongoingTouches[idx].pageY);
                    ctx.lineTo(touches[i].pageX, touches[i].pageY);
                    ctx.fillRect(touches[i].pageX - 4, touches[i].pageY - 4, 8, 8); // and a square at the end
                    ongoingTouches.splice(idx, 1); // remove it; we're done
                    ctx.closePath()
                } 
                else 
                {
                    log("On ne sait pas avec quel touché finir");
                }
            }
        }

        function annuler(event) {
            event.preventDefault();
            log("annulation du touché ");
            const touches = event.changedTouches;

            for (let i = 0; i < touches.length; i++) {
                let idx = ongoingTouchIndexById(touches[i].identifier);
                ongoingTouches.splice(idx, 1); // remove it; we're done
            }
        }

        function colorForTouch(touch) 
        {
            let r = touch.identifier % 16;
            let g = Math.floor(touch.identifier / 3) % 16;
            let b = Math.floor(touch.identifier / 7) % 16;
            r = r.toString(16); // make it a hex digit
            g = g.toString(16); // make it a hex digit
            b = b.toString(16); // make it a hex digit
            const color = `#${r}${g}${b}`;
            return color;
        }

        function copyTouch({ identifier, pageX, pageY }) 
        {
            return { identifier, pageX, pageY };
        }

        function ongoingTouchIndexById(idToFind) {
            for (let i = 0; i < ongoingTouches.length; i++) {
                const id = ongoingTouches[i].identifier;

                if (id === idToFind) 
                {
                    return i;
                }
            }
            return -1; // not found
        }

        function log(msg) 
        {
            const container = document.getElementById("log");
            container.innerHTML = `${msg} \n${container.textContent}`;
        }

    </script>

    <h1>TD3 Cartographie</h1>

    <h2> Exercice 1 : version Canvas</h2>
        <canvas id="canvasEx1" width="500" height="500"></canvas>    
        <img id="sea" alt="not working !" src="mer-mediterranee.jpg" width="500" height="500">

        <script>
            canvas = document.getElementById('canvasEx1');
            var myimg = document.getElementById('sea');
            var ctx = canvas.getContext('2d');
            myimg.onload = function() {
                ctx.drawImage(myimg, 0, 0);
                ctx.fillStyle = '#AA0000';
                ctx.beginPath();
                ctx.moveTo(150, 250);
                ctx.lineTo(150, 400);
                ctx.lineTo(100, 400);
                ctx.closePath();
                ctx.lineWidth = 1;
                ctx.stroke();
                ctx.fill();

                ctx.beginPath();
                ctx.moveTo(165,250)
                ctx.lineTo(165,400)
                ctx.lineTo(250,400)
                ctx.closePath();
                ctx.lineWidth = 1;
                ctx.stroke();
                ctx.fill();

                ctx.beginPath();
                ctx.fillStyle = '#FF0000';
                ctx.moveTo(100,410);
                ctx.lineTo(230,410);
                ctx.lineTo(150,460);
                ctx.closePath();
                ctx.lineWidth = 1;
                ctx.stroke();
                ctx.fill();

                ctx.beginPath();
                ctx.fillStyle = '#FFFF00';
                ctx.arc(450, 50, 40, 0, 2 * Math.PI);
                ctx.stroke();
                ctx.fill();
            }
        </script>

        <h2> Exercice 1 : version SVG</h2>
        <svg width="500" height="500">
            <circle cx="50" cy="50" r="40" stroke="green" stroke-width="4" fill="yellow" />
            <rect width="500" height="300" style="fill:rgb(0,0,255);stroke-width:2;stroke:rgb(0,0,0)" />
            <rect width="500" height="200" style="fill:rgb(100,100,255);stroke-width:2;stroke:rgb(0,0,0)" />
            <polygon points="50,200 250,190 160,210" style="fill:lime;stroke:purple;stroke-width:1" />
        </svg>

        <h2> Exercice 2 : </h2>

        <script type="module" src="TD3_Ex3.js">
            
        </script>



</html>

